<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tgis.report.mmpMng.service.MmpMngMapper">
	<select id="selectFacilCntList" parameterType="map" resultType="egovMap">
		<![CDATA[
			SELECT MTN_YYYYMM.KND, SUM(CNT) as cnt, M_CODE.CMMT AS KND_NAME
			FROM MTN_YYYYMM LEFT JOIN M_CODE ON (M_CODE.CD=MTN_YYYYMM.KND AND (M_CODE.REFCDTP='MTN_YYYYMM' AND M_CODE.CDN='KND'))
			WHERE 1=1
			AND MTN_YYYYMM.GUBUN IN ('교통안전시설물', '도로안전시설물', '특수교통운영구역')
		]]>

		<if test="fromDate != null and fromDate != ''">
			<![CDATA[
				AND MTN_YM >= #{fromDate}
			]]>
		</if>
		<if test="toDate != null and toDate != ''">
			<![CDATA[
				AND MTN_YM <= #{toDate}
			]]>
		</if>

		<![CDATA[
			GROUP BY KND, M_CODE.CMMT
		]]>
	</select>

	<select id="selectMonthCnt" parameterType="map" resultType="egovMap">
		<![CDATA[
			SELECT
				SUM (DECODE(KND,
					'제어기',CNT,
					'신호등',CNT,
					'지주',CNT,
					'부착대',CNT ,
					'검지기',CNT,
					'안전표지',CNT,
					'유턴구역',CNT,
					'정지선',CNT,
					'노면방향표시',CNT,
					'노면문자표시',CNT,
					'횡단보도',CNT,
					'횡단보도예고표시',CNT,
					'정차금지지대',CNT,
					'주차구획',CNT
				) )  AS SUM1 ,

				SUM (DECODE(KND,
					'중앙선',CNT,
					'차선',CNT,
					'주차금지',CNT
				) )  AS SUM2,

				SUM (DECODE(KND,
					'CCTV',CNT,
					'전광판',CNT,
					'음향신호기',CNT,
					'과속방지턱',CNT,
					'도로반사경',CNT,
					'충격흡수시설',CNT,
					'장애물표적표시',CNT ,
					'시선유도봉',CNT,
					'갈매기표지',CNT,
					'고원식교차로',CNT,
					'교통섬',CNT,
					'조명시설',CNT
				) )  AS SUM3,

				SUM (DECODE(KND,
					'표지병',CNT,
					'방호울타리',CNT,
					'칼라포장',CNT,
					'미끄럼방지시설',CNT
				) )  AS SUM4,

				SUM (DECODE(KND,
					'시선유도표지',CNT,
					'입체횡단시설',CNT,
					'어린이보호구역',CNT,
					'노인보호구역',CNT,
					'일방통행',CNT
				) )  AS SUM5,

				SUM (DECODE(KND,
					'자전거전용도로',CNT
				) )  AS SUM6

			FROM MTN_YYYYMM
			LEFT JOIN M_CODE ON (M_CODE.CD=MTN_YYYYMM.KND AND (M_CODE.REFCDTP='MTN_YYYYMM' AND M_CODE.CDN='KND'))
			WHERE 1=1
		]]>

		<if test="fromDate != '' and fromDate != null">
			<![CDATA[ AND SUBSTR(MTN_YM, 0, 7) >= (SUBSTR(#{fromDate}, 0, 7)) ]]>
		</if>

		<if test="toDate != '' and toDate != null">
			<![CDATA[ AND SUBSTR(MTN_YM, 0, 7) <= (SUBSTR(#{toDate}, 0, 7)) ]]>
		</if>
	</select>

	<select id="selectYearCnt" parameterType="map" resultType="egovMap">
		<![CDATA[
			SELECT
				SUM (DECODE(KND,
					'제어기',CNT,
					'신호등',CNT,
					'지주',CNT,
					'부착대',CNT ,
					'검지기',CNT,
					'안전표지',CNT,
					'유턴구역',CNT,
					'정지선',CNT,
					'노면방향표시',CNT,
					'노면문자표시',CNT,
					'횡단보도',CNT,
					'횡단보도예고표시',CNT,
					'정차금지지대',CNT,
					'주차구획',CNT,
					'CCTV',CNT,
					'전광판',CNT,
					'음향신호기',CNT,
					'과속방지턱',CNT,
					'도로반사경',CNT,
					'충격흡수시설',CNT,
					'장애물표적표시',CNT ,
					'시선유도봉',CNT,
					'갈매기표지',CNT,
					'고원식교차로',CNT,
					'교통섬',CNT,
					'조명시설',CNT,
					'시선유도표지',CNT,
					'입체횡단시설',CNT,
					'어린이보호구역',CNT,
					'노인보호구역',CNT,
					'일방통행',CNT
				) )  AS SUM1 ,

				SUM (DECODE(KND,
					'중앙선',CNT,
					'차선',CNT,
					'주차금지',CNT,
					'표지병',CNT,
					'방호울타리',CNT,
					'칼라포장',CNT,
					'미끄럼방지시설',CNT,
					'자전거전용도로',CNT
				) )  AS SUM2

			FROM MTN_YYYYMM
			LEFT JOIN M_CODE ON (M_CODE.CD=MTN_YYYYMM.KND AND (M_CODE.REFCDTP='MTN_YYYYMM' AND M_CODE.CDN='KND'))
			WHERE 1=1
		]]>

		<if test="fromDate != '' and fromDate != null">
			<![CDATA[ AND SUBSTR(MTN_YM, 0, 4) >= (SUBSTR(#{fromDate}, 0, 4)) ]]>
		</if>

		<if test="toDate != '' and toDate != null">
			<![CDATA[ AND SUBSTR(MTN_YM, 0, 4) <= (SUBSTR(#{toDate}, 0, 4)) ]]>
		</if>
	</select>

</mapper>